"use strict";let App={},flatsFilter={};const roomsFilterButtons=document.querySelector(".js-rooms-filter-btns"),pageMainContent=document.querySelector(".js-main"),flat=document.querySelector(".js-flat"),buttonUp=document.querySelector(".js-button-up"),wrapListFlats=document.querySelector(".js-flats-list"),resetButton=document.querySelector(".js-reset-button"),forSearchMinMaxFlats=1e4,breakPointMediumSize=768,numberOfCards=20;let count=0,countElse=1,startState=4,div=document.createElement("div");div.style.overflowY="scroll",div.style.width="100%",div.style.height="50px",document.body.append(div);let scrollWidth=div.offsetWidth-div.clientWidth;div.remove(),renderCreateTitle(),getResponse(startState,!0),window.addEventListener("resize",(function(){renderCreateTitle()})),roomsFilterButtons.addEventListener("click",(function(t){flatsFilter.rooms=[];const e=t.target.closest(".js-number-of-rooms");if(!e)return;e.classList.toggle("active");document.querySelectorAll(".js-number-of-rooms").forEach(t=>{t.classList.contains("active")&&flatsFilter.rooms.push(+t.getAttribute("id"))}),App.hasArguments=flatsFilter.rangeArea?["rangeArea","area"]:["rangeCost","cost"],getResponse(App.stateView,!1,"roomsHandler",App.filterRender(...App.hasArguments))})),resetButton.addEventListener("click",(function(){let t=$(".js-range-slider-input-cost").data("ionRangeSlider");const e=document.querySelector(".js-watch-more-btn");document.querySelectorAll(".js-number-of-rooms").forEach(t=>t.classList.remove("active")),t.reset(),getResponse(startState,!0,"reset"),count=0,flatsFilter={},App.stateView=4,App.rangeCost={},App.rangeArea={},App.rooms=[],e||createButtonWatchMore(startState)})),window.addEventListener("scroll",(function(t){pageYOffset>=window.innerHeight/2?buttonUp.classList.add("show"):buttonUp.classList.remove("show")})),buttonUp.addEventListener("click",(function(){pageMainContent.scrollIntoView({behavior:"smooth"})})),App.ascending=!0,document.querySelector(".js-top-filter-block").addEventListener("click",filteredOfOptions);const flatHtmlTemplate=t=>`<li class="flats-list__item js-flat">\n\t\t<div class="flats-list__info">\n\t\t\t<h2 class="flats-list__title">${t.rooms}-комнатная № ${t.apartment}</h2>\n\t\t\t<div class="flats-list__options">\n\t\t\t\t<div class="flats-list__option flats-block__width">${t.options.area} <span>м<sup>2</sup></span></div>\n\t\t\t\t<div class="flats-list__option flats-block__width">${t.options.stage} <span>из 17 <span>этаж</span></span></div>\n\t\t\t\t<div class="flats-list__option flats-block__width">${reformatNumbers(t.options.cost)} <span>₽</span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<picture>\n\t\t\t<source srcset="${t.image}" type="image/webp">\n\t\t\t<img src="${t.image}" alt="${t.name}" class="flats-list__image">\n\t\t</picture>\n</li>\n`;function reformatNumbers(t){return t.toLocaleString("ru-RU")}async function getResponse(t=4,e=!1,s=null,n=null){const o=document.querySelector(".js-watch-more-btn"),l=document.querySelectorAll(".js-number-of-rooms"),r=[],a=[];let i=0;const c=await fetch("https://ilyariver.github.io/kelnikflats.io/data.json");if("slide"!==s&&"clickFilter"!==s&&App.createSkeletons(),c.ok){const p=await c.json(),d=p,u=t=>d.reduce((e,s)=>Number.parseInt(e.options[t])<Number.parseInt(s.options[t])?e:s),m=t=>d.reduce((e,s)=>Number.parseInt(e.options[t])>Number.parseInt(s.options[t])?e:s);o&&t>=d.length&&o.remove();const f=u("cost").options.cost,g=m("cost").options.cost,_=u("area").options.area,b=m("area").options.area;if(e){let t=$(".js-range-slider-input-cost").data("ionRangeSlider"),e=$(".js-range-slider-input-area").data("ionRangeSlider");t.update({min:f-1e4,max:g+1e4,from:f-1e4,to:g+1e4}),e.update({min:Number.parseInt(_),max:Number.parseInt(b),from:Number.parseInt(_),to:Number.parseInt(b)})}l.forEach(t=>r.push(+t.querySelector("span").textContent)),d.forEach(t=>a.push(t.rooms)),r.filter(t=>{if(!a.includes(t)){const e=document.getElementById(t);e.setAttribute("disabled",!0),e.classList.remove("hovered"),e.style.cursor="auto"}}),window.addEventListener("resize",(function(){pageMainContent.style.width="",pageMainContent.style.width=pageMainContent.clientWidth+"px"})),1!==countElse||s||(countElse++,await createButtonWatchMore(t)),getScroll("Height")&&s||(pageMainContent.style.width="",pageMainContent.style.width=pageMainContent.clientWidth-scrollWidth+"px"),i=p.length,"clickFilter"!==s&&(App.contentSplice=p.splice(0,t)),(n&&"handler"===s||n&&"clickFilter"===s)&&(n=App.filterRender(...App.hasArguments));let h=(n||App.contentSplice).map(t=>flatHtmlTemplate(t));setTimeout(()=>{wrapListFlats.innerHTML=h.join("");const t=document.querySelectorAll(".js-flat");t.forEach(t=>t.style.opacity="0"),document.querySelectorAll(".js-skeletons").forEach(t=>t.remove()),setTimeout(()=>{t.forEach(t=>t.style.cssText="\n\t\t\t\t\topacity: '1';\n\t\t\t\t\ttransition: opacity 0.2s ease;\n\t\t\t\t")},100),function(){const t=document.querySelectorAll(".js-flat"),e=document.querySelector(".js-notice-of-empty");t.length||e||($("<p/>",{class:"notice-of-empty js-notice-of-empty",text:"Квартиры по заданному фильтру отсутствуют..."}).appendTo(".js-flats-block"),countElse=1);t.length&&e&&e.remove()}(),function(){const t=document.querySelectorAll(".js-flat"),e=document.querySelector(".js-watch-more-btn");if(!e)return;t.length===i&&(e.remove(),countElse=1)}()},500),App.filterRender=(t="rangeCost",e="cost")=>{let s="",n=!!flatsFilter.rooms&&flatsFilter.rooms.length;if(n&&(s=App.contentSplice.filter(t=>flatsFilter.rooms.includes(t.rooms))),flatsFilter[t]){s=(n?s:App.contentSplice).filter(s=>flatsFilter[t]&&Number.parseInt(s.options[e])>=flatsFilter[t].from&&Number.parseInt(s.options[e])<=flatsFilter[t].to)}const o="rangeCost"===t?flatsFilter.rangeArea:flatsFilter.rangeCost,l="rangeCost"===t?"area":"cost";return o&&s.length?s.filter(t=>o&&Number.parseInt(t.options[l])>=o.from&&Number.parseInt(t.options[l])<=o.to):s}}else alert("Ошибка: "+c.status)}function filteredOfOptions(t){const e=t.target,s=e.closest(".filters-list__arrow-btn");if(!s)return;const n=s.dataset.option;document.querySelectorAll(".filters-list__arrow-btn").forEach(t=>t.style.color="#0b1739"),e.closest(".filters-list__arrow-btn").style.color="#3EB57C",renderFilterOfType(n)}function renderFilterOfType(t){App.contentSplice.sort(byField("options",t)),App.contentSplice=App.contentSplice.filter(e=>App.contentSplice.map(e=>e.options[t]).includes(e.options[t])),App.hasArguments=flatsFilter.rangeArea?["rangeArea","area"]:["rangeCost","cost"];const e=!!flatsFilter&&App.filterRender(...App.hasArguments);getResponse(App.stateView,!1,"clickFilter",e)}function byField(t,e){return App.ascending?(App.ascending=!1,(s,n)=>Number.parseInt(s[t][e])>Number.parseInt(n[t][e])?1:-1):(App.ascending=!0,(s,n)=>Number.parseInt(s[t][e])<Number.parseInt(n[t][e])?1:-1)}function getScroll(t){const e=document,s=e.body,n=e.documentElement,o="client"+t;return t="scroll"+t,/CSS/.test(e.compatMode)?n[o]<n[t]:s[o]<s[t]}function createButtonWatchMore(t){$("<button/>",{type:"button",class:"watch-more-btn js-watch-more-btn",text:"Загрузить еще"}).appendTo(".js-section-flats-container"),document.querySelector(".js-watch-more-btn").addEventListener("click",(function(){App.hasArguments=flatsFilter.rangeArea?["rangeArea","area"]:["rangeCost","cost"],App.stateView=20+t;const e=!!flatsFilter&&App.filterRender(...App.hasArguments);count+=20+t,getResponse(count,!1,"handler",e),t=0}))}function renderCreateTitle(){if(window.innerWidth>=768)return createTitle(".js-flats-block");createTitle(".js-section-flats-container")}function createTitle(t){document.getElementById("main-title").remove(),$("<div/>",{id:"main-title",class:"section-flats__title js-flats-block-title",text:"Квартиры"}).prependTo(t)}App.createSkeletons=function(){const t=document.querySelector(".js-notice-of-empty");t&&t.remove(),wrapListFlats.innerHTML="",wrapListFlats.insertAdjacentHTML("beforeend",'\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t<div class="skeletons__body">\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t</div>\n\t\t\t<div class="skeletons__img"></div>\n\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t<div class="skeletons__body">\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t</div>\n\t\t\t<div class="skeletons__img"></div>\n\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t<div class="skeletons__body">\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t</div>\n\t\t\t<div class="skeletons__img"></div>\n\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t<div class="skeletons__body">\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t</div>\n\t\t\t<div class="skeletons__img"></div>\n\t\t</li>')};
